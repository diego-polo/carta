<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Sopa de Letras - Era Neolítica</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&display=swap" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #e0c3fc 0%, #8ec5fc 100%);
            font-family: 'Montserrat', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
        }
        h1 {
            margin-top: 30px;
            color: #3d2c8d;
            letter-spacing: 2px;
            text-shadow: 1px 1px 8px #fff;
        }
        .timer {
            font-size: 1.5em;
            color: #fff;
            background: #3d2c8d;
            border-radius: 10px;
            padding: 10px 30px;
            margin: 20px 0;
            box-shadow: 0 2px 8px #bdbdbd;
        }
        .word-list {
            margin: 20px 0 10px 0;
            padding: 15px 30px;
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 2px 8px #bdbdbd;
            color: #3d2c8d;
            font-size: 1.1em;
        }
        .word-list span.found {
            text-decoration: line-through;
            color: #aaa;
        }
        table.sopa {
            border-collapse: collapse;
            margin: 0 auto 30px auto;
            background: #fff;
            border-radius: 15px;
            box-shadow: 0 4px 16px #bdbdbd;
            overflow: hidden;
        }
        table.sopa td {
            width: 38px;
            height: 38px;
            text-align: center;
            font-size: 1.3em;
            font-weight: bold;
            color: #3d2c8d;
            border: 1px solid #bdbdbd;
            cursor: pointer;
            transition: background 0.2s, color 0.2s;
            user-select: none;
        }
        table.sopa td.selected {
            background: #8ec5fc;
            color: #fff;
        }
        table.sopa td.found {
            background: #3d2c8d;
            color: #fff;
        }
        .footer {
            margin-top: auto;
            margin-bottom: 20px;
            color: #3d2c8d;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <h1>Sopa de Letras: Era Neolítica</h1>
    <div class="timer" id="timer">01:00</div>
    <div class="word-list" id="word-list">
        <strong>Palabras:</strong>
        <span>AGRICULTURA</span>, 
        <span>GANADERIA</span>, 
        <span>CERAMICA</span>, 
        <span>PIEDRA</span>, 
        <span>ALDEA</span>, 
        <span>MOLINO</span>, 
        <span>TEJIDO</span>, 
        <span>HERRAMIENTA</span>, 
        <span>CESTA</span>, 
        <span>DOMESTICAR</span>
    </div>
    <table class="sopa" id="sopa">
        <!-- La sopa de letras se genera por JS -->
    </table>
    <div class="footer">
        &copy; 2025 Sopa de Letras Neolítica
    </div>
    <script>
        // Palabras a buscar
        const palabras = [
            "AGRICULTURA", "GANADERIA", "CERAMICA", "PIEDRA", "ALDEA",
            "MOLINO", "TEJIDO", "HERRAMIENTA", "CESTA", "DOMESTICAR"
        ];

        const N = 10;
        const sopa = Array.from({length: N}, () => Array(N).fill(''));

        // Direcciones: [dr, dc]
        const direcciones = [
            [0,1], [1,0], [1,1], [-1,0], [0,-1], [0, -1], [-1,1], [1,-1]
        ];

        function colocarPalabra(palabra) {
            let intentos = 0;
            while (intentos < 1000) {
                const dir = direcciones[Math.floor(Math.random()*direcciones.length)];
                const dr = dir[0], dc = dir[1];
                let r = Math.floor(Math.random()*N);
                let c = Math.floor(Math.random()*N);

                // Verifica si cabe
                let cabe = true;
                for (let i = 0; i < palabra.length; i++) {
                    let nr = r + dr*i, nc = c + dc*i;
                    if (nr < 0 || nr >= N || nc < 0 || nc >= N) {cabe = false; break;}
                    if (sopa[nr][nc] !== '' && sopa[nr][nc] !== palabra[i]) {cabe = false; break;}
                }
                if (!cabe) {intentos++; continue;}
                // Coloca la palabra
                for (let i = 0; i < palabra.length; i++) {
                    let nr = r + dr*i, nc = c + dc*i;
                    sopa[nr][nc] = palabra[i];
                }
                return true;
            }
            return false;
        }

        // Coloca todas las palabras
        palabras.forEach(palabra => colocarPalabra(palabra));

        // Rellena los huecos con letras aleatorias
        const letras = "ABCDEFGHIJKLMNÑOPQRSTUVWXYZ";
        for (let i = 0; i < N; i++) {
            for (let j = 0; j < N; j++) {
                if (sopa[i][j] === '') {
                    sopa[i][j] = letras[Math.floor(Math.random()*letras.length)];
                }
            }
        }

        // Generar la tabla de la sopa de letras
        const tabla = document.getElementById('sopa');
        for(let i=0; i<N; i++) {
            const fila = document.createElement('tr');
            for(let j=0; j<N; j++) {
                const celda = document.createElement('td');
                celda.textContent = sopa[i][j];
                celda.dataset.row = i;
                celda.dataset.col = j;
                fila.appendChild(celda);
            }
            tabla.appendChild(fila);
        }

        // Selección interactiva
        let seleccion = [];
        let seleccionando = false;

        tabla.addEventListener('mousedown', e => {
            if(e.target.tagName === 'TD') {
                seleccionando = true;
                seleccion = [[+e.target.dataset.row, +e.target.dataset.col]];
                e.target.classList.add('selected');
            }
        });

        tabla.addEventListener('mouseover', e => {
            if(seleccionando && e.target.tagName === 'TD') {
                const last = seleccion[seleccion.length-1];
                const row = +e.target.dataset.row;
                const col = +e.target.dataset.col;
                // Solo agrega si es adyacente y no repetido
                if (!seleccion.some(([r,c])=>r===row&&c===col) && 
                    (Math.abs(row-last[0])<=1 && Math.abs(col-last[1])<=1)) {
                    seleccion.push([row, col]);
                    e.target.classList.add('selected');
                }
            }
        });

        document.addEventListener('mouseup', () => {
            if(seleccion.length > 1) {
                const palabra = obtenerPalabraSeleccionada(seleccion);
                const palabraInv = palabra.split('').reverse().join('');
                let idx = palabras.indexOf(palabra);
                if(idx === -1) idx = palabras.indexOf(palabraInv);
                if(idx !== -1 && !palabrasEncontradas.has(palabras[idx])) {
                    // Marcar celdas encontradas
                    seleccion.forEach(([r,c]) => {
                        tabla.rows[r].cells[c].classList.add('found');
                    });
                    palabrasEncontradas.add(palabras[idx]);
                    // Tacharla en la lista
                    const spans = document.querySelectorAll('#word-list span');
                    spans.forEach(span => {
                        if(span.textContent === palabras[idx]) span.classList.add('found');
                    });
                }
            }
            // Limpiar selección visual
            document.querySelectorAll('td.selected').forEach(td => td.classList.remove('selected'));
            seleccion = [];
            seleccionando = false;
        });

        // Obtener la palabra seleccionada según las coordenadas
        function obtenerPalabraSeleccionada(coords) {
            // Ordenar por inicio a fin
            const [start, end] = [coords[0], coords[coords.length-1]];
            let dr = Math.sign(end[0] - start[0]);
            let dc = Math.sign(end[1] - start[1]);
            let palabra = '';
            let r = start[0], c = start[1];
            for(let i=0; i<coords.length; i++) {
                palabra += sopa[r][c];
                r += dr;
                c += dc;
            }
            return palabra;
        }

        // Palabras encontradas
        const palabrasEncontradas = new Set();

        // Temporizador de 1 minuto
        let tiempo = 60;
        const timer = document.getElementById('timer');
        const intervalo = setInterval(() => {
            tiempo--;
            let min = String(Math.floor(tiempo/60)).padStart(2,'0');
            let seg = String(tiempo%60).padStart(2,'0');
            timer.textContent = `${min}:${seg}`;
            if(tiempo <= 0) {
                clearInterval(intervalo);
                timer.textContent = "¡Tiempo!";
                setTimeout(() => {
                    window.location.href = "../Neolitico/juegos_Neolitico.html";
                }, 1200);
            }
        }, 1000);
    </script>
</body>
</html>